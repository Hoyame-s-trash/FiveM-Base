import{r as i,a as h,j as o}from"./jsx-runtime-7cf68bf7.js";import{u as E,f as S,aH as g,B as y,L as d,bp as w,bq as L,q as T,br as U,bs as Y,aa as _,a8 as N,C as b,N as R,b as A}from"./Phone-f429e90b.js";const O=i.createContext(null);function F(){var C;const e=E(R),s=E(A.Settings),[c,l]=i.useState(0),[P,v]=i.useState([]),[p,t]=i.useState(""),[a,r]=i.useState(0),[n,m]=i.useState(s==null?void 0:s.streamerMode);return i.useEffect(()=>{S("Crypto",{action:"get"}).then(u=>{u&&v(u)})},[]),i.useEffect(()=>l(P.reduce((u,f)=>u+(f.owned??0)*f.current_price,0)),[P]),i.useEffect(()=>{r(n?g("âˆ—".repeat(y(c,2).toString().length)):g(y(c,2)))},[c,n]),h("div",{className:"crypto-container",children:[h("div",{className:"crypto-header",children:[o("img",{src:"./assets/img/icons/apps/Cryptopng.png",alt:"btc"}),d("APPS.CRYPTO.TITLE")]}),o(O.Provider,{value:{Coins:[P,v]},children:h("div",{className:"crypto-wrapper",children:[h("div",{className:"balance",children:[h("div",{className:"title",children:[d("APPS.CRYPTO.BALANCE"),o("div",{className:"icon",onClick:()=>m(!n),children:n?o(w,{}):o(L,{})})]}),o("div",{className:"amount",onClick:()=>m(!n),children:(C=e==null?void 0:e.CurrencyFormat)==null?void 0:C.replace("%s",a)})]}),o("div",{className:"search",children:o(T,{placeholder:"Search Cryptocurrency",onChange:u=>t(u.target.value)})}),o(x,{search:p}),o("div",{className:"credits",children:"Powered by CoinGecko"})]})})]})}const x=({search:e})=>{const[s,c]=i.useState("balance"),[l,P]=i.useState(!0),v=["Name","Graph","Balance"],[p]=i.useContext(O).Coins;return o("div",{className:"holdings",children:h("div",{className:"items",children:[o("div",{className:"item filters",children:v.map((t,a)=>h("div",{className:"filter",onClick:()=>{if(c(t.toLowerCase()),s===t.toLowerCase())return P(!l);P(!0)},children:[t,t.toLowerCase()===s&&l?o(U,{}):o(Y,{})]},a))}),p.sort((t,a)=>s==="name"?l?t.name.localeCompare(a.name):a.name.localeCompare(t.name):s==="graph"?l?t.change_24h-a.change_24h:a.change_24h-t.change_24h:s==="balance"?l?(a.owned??0)*a.current_price-(t.owned??0)*t.current_price:(t.owned??0)*t.current_price-(a.owned??0)*a.current_price:0).filter(t=>t.name.toLowerCase().includes(e.toLowerCase())||t.symbol.toLowerCase().includes(e.toLowerCase())).map((t,a)=>o(B,{data:t},a))]})})},B=({data:e})=>{const[s,c]=i.useState(!1),[l,P]=i.useState(""),[v,p]=i.useContext(O).Coins,t=(r,n)=>{S("Crypto",{action:"buy",coin:r,amount:n}).then(m=>{if(m!=null&&m.success)return p(C=>C.map(u=>u.id===r?{...u,owned:(u.owned??0)+n/u.current_price,value:(u.value??0)+n}:u))})},a=(r,n,m)=>{S("Crypto",{action:"sell",coin:r,amount:m}).then(C=>{if(C!=null&&C.success)return p(u=>u.map(f=>f.id===r?{...f,owned:(f.owned??0)-n/f.current_price,value:(f.value??0)+n}:f))})};return e.symbol=e.symbol.toUpperCase(),e.owned=e.owned??0,e.value=e.current_price*(e.owned??0),h("div",{className:"item",onClick:()=>c(!s),children:[h("div",{className:"top",children:[h("div",{className:"info",children:[o("img",{src:e.image,className:"icon",alt:"Icon"}),h("div",{className:"coin",children:[o("div",{className:"name",children:e.symbol}),o("div",{className:"symbol",children:e.name})]})]}),o(I,{prices:e.prices}),h("div",{className:"amount",children:[o("div",{className:"value",children:g(y(e.owned,4))}),h("div",{className:"asset",children:["$",g(y(e.value,2))]})]})]}),o(_,{children:s&&h(N.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},className:"bottom",children:[o(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button fill",onClick:r=>{r.stopPropagation(),b.PopUp.set({title:d("APPS.CRYPTO.BUY_POPUP.TITLE").format({coin:e.symbol}),description:d("APPS.CRYPTO.BUY_POPUP.DESCRIPTION").format({coin:e.symbol}),input:{placeholder:d("APPS.CRYPTO.BUY_POPUP.PLACEHOLDER"),type:"number",value:0,onChange:n=>P(n)},buttons:[{title:d("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:d("APPS.CRYPTO.BUY_POPUP.PROCEED"),cb:()=>{P(n=>(t(e.id,parseFloat(n)),n))}}]})},children:d("APPS.CRYPTO.BUY")}),o(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button",onClick:r=>{r.stopPropagation(),b.PopUp.set({title:d("APPS.CRYPTO.SELL_POPUP.TITLE").format({coin:e.symbol}),description:d("APPS.CRYPTO.SELL_POPUP.DESCRIPTION").format({coin:e.symbol}),input:{placeholder:d("APPS.CRYPTO.BUY_POPUP.PLACEHOLDER"),type:"number",value:0,onChange:n=>P(n)},buttons:[{title:d("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:d("APPS.CRYPTO.BUY_POPUP.PROCEED"),cb:()=>{P(n=>{let m=parseFloat(n),C=m/e.current_price;return a(e.id,m,C),n})}}]})},children:d("APPS.CRYPTO.SELL")})]})})]})},I=({prices:e})=>{if(!e)return null;const s=i.useRef(null);return e=e.slice(0,24),i.useEffect(()=>{if(!(s!=null&&s.current))return;const c=s.current;c.width=150,c.height=100;const l=c.getContext("2d");l.lineWidth=3;const P=Math.min(...e),p=Math.max(...e)-P,t=c.height-10;let a=0,r=c.height-5-(e[0]-P)/p*t;l.beginPath(),l.moveTo(a,r);const n=e[e.length-1]-e[0]>0?"green":"red";l.strokeStyle=n;for(let m=1;m<e.length;m++)a+=c.width/(e.length-1),r=c.height-5-(e[m]-P)/p*t,l.lineTo(a,r);l.stroke()},[s,e]),o("canvas",{ref:s})};export{F as default};
