import{r as i,a as t,j as a,F as M}from"./jsx-runtime-bb820e81.js";import{u as g,f as b,H as k,L as s,o as _,j as S,B as C,aG as x,aH as P,b as F,N as $}from"./Phone-a7ab6193.js";import{N as B}from"./Numpad-68ff3ca2.js";function j(){const o=g(F.Settings),n=g($),[r,L]=i.useState({balance:0,transactions:[],bills:[]}),[N,u]=i.useState(!1),[W,w]=i.useState(""),[c,T]=i.useState(0),[y,A]=i.useState(!1),[l,f]=i.useState(""),[E,v]=i.useState(null);i.useEffect(()=>{b("Wallet",{action:"getData"}).then(e=>{e&&L(e)})},[]),i.useEffect(()=>{f(""),T(0)},[N]),k("wallet:addTransaction",e=>{o.airplaneMode||L({...r,balance:r.balance+parseFloat(e.amount),transactions:[{...e,timestamp:Date.now()},...r.transactions].slice(0,5)})}),i.useEffect(()=>{c===0?l.length>3?A(!0):A(!1):c===1&&(l.length>0&&O(l)&&parseFloat(l)<=(n.MaxTransferAmount??Number.MAX_SAFE_INTEGER)?A(!0):A(!1))},[l]);const O=e=>r.balance>=e,I=e=>{if(e=="backspace")return f(d=>d.length>0?d.slice(0,-1):"0");f(d=>d+e)};i.useEffect(()=>{if(c!==1||l.length>=9)return;const e=document.getElementById("number");e.style.width=`${l.length}ch`,E&&v(null)},[l]);const D=(e,d)=>{let m=new Date(e),h=new Date-m;return h<1e3*60?s("APPS.WALLET.NOW"):h<36e5?`${Math.floor(h/6e4)}${s("M")} ${s("APPS.WALLET.AGO")}`:h<864e5?`${Math.floor(h/36e5)}${s("H")} ${s("APPS.WALLET.AGO")}`:h<1728e5?`${s("APPS.CLOCK.WORLDCLOCK.YESTERDAY")}, ${m.toLocaleTimeString(n.DateLocale,{hour:"numeric",minute:"numeric",hour12:d})}`:h<6048e5?`${m.toLocaleDateString(n.DateLocale,{weekday:"short"})}, ${m.toLocaleTimeString(n.DateLocale,{hour:"numeric",minute:"numeric",hour12:d})}`:m.toLocaleDateString(n.DateLocale,{year:"numeric",month:"numeric",day:"numeric"})};return i.useEffect(()=>{v(null)},[c]),t("div",{className:"wallet-app-container",children:[N&&t("div",{className:"send-container",children:[t("div",{className:"send-header",children:[a("div",{onClick:()=>u(!1),children:s("CANCEL")}),c===2?a("div",{onClick:()=>u(!1),children:s("APPS.WALLET.DONE")}):a("div",{className:!y&&"disabled",onClick:()=>{if(y){if(c==0)b("Wallet",{action:"doesNumberExist",number:l}).then(e=>{e?(w(l),T(1),f("")):v(s("APPS.WALLET.NUMBER_DOES_NOT_EXIST"))});else if(c==1){if(!O(l))return v(s("APPS.WALLET.NOT_ENOUGH_MONEY"));if(parseFloat(l)>(n.MaxTransferAmount??Number.MAX_SAFE_INTEGER))return v("Max transfer amount reached");if(o.airplaneMode)return;b("Wallet",{action:"sendPayment",number:W,amount:Math.floor(l)}).then(e=>{e!=null&&e.success?T(2):v(s("APPS.WALLET.NOT_ENOUGH_MONEY"))})}}},children:s("APPS.WALLET.NEXT")})]}),t("div",{className:"send-wrapper",children:[c===0&&t(M,{children:[a("div",{className:"user",children:a(_,{className:"number_input",type:"number",onChange:e=>f(e.target.value.replace(/[^0-9]/g,"")),value:l,placeholder:S("1234567890")})}),a("div",{className:"description",children:s("APPS.WALLET.NO_REFUNDS")}),E&&a("div",{className:"error",children:E})]}),c===1&&t(M,{children:[t("div",{className:"amount",children:[a("div",{className:"symbol",children:n.CurrencyFormat.replace("%s","")}),a(_,{type:"number",id:"number",value:l,onChange:e=>f(e.target.value.replace(/[^0-9]/g,""))})]}),t("div",{className:"description",children:[s("APPS.WALLET.NEW_BALANCE"),": ",n.CurrencyFormat.replace("%s",""),C(r.balance-l,2)]}),E&&a("div",{className:"error",children:E})]}),c===2&&t("div",{className:"success",children:[a(x,{}),a("div",{className:"title",children:s("APPS.WALLET.DONE")}),a("div",{className:"subtitle",children:s("APPS.WALLET.DONE_SUBTITLE").format({amount:n.CurrencyFormat.replace("%s",l),number:S(W)})})]})]}),c!==2&&a("div",{className:"numpad-wrapper",children:a(B,{cb:e=>I(e)})})]}),t("div",{className:"overview",children:[a("div",{className:"header-title",children:s("APPS.WALLET.TITLE")}),t("div",{className:"wrapper",children:[a("div",{className:"card"}),a("section",{children:t("div",{className:"item space",children:[t("div",{className:"balance",children:[a("div",{className:"title",children:s("APPS.WALLET.BALANCE")}),a(G,{amount:r.balance})]}),a("div",{className:"button",onClick:()=>u(!0),children:s("APPS.WALLET.SEND")})]})}),a("div",{className:"subtitle",children:a("div",{className:"title",children:s("APPS.WALLET.LATEST_TRANSACTIONS")})}),r.transactions&&r.transactions.length>0&&a("section",{children:r.transactions.map((e,d)=>{let m=e.amount>0,p=e.company.match(/\d{10}/);return t("div",{className:"item multi",children:[e.logo?a("img",{src:e.logo}):!p&&a("div",{className:"image",children:e.company[0]}),t("div",{className:"info",children:[t("div",{className:"transaction-header",children:[a("div",{className:"title",children:p?S(e.company):e.company}),a("div",{className:"right",children:t("div",{className:`amount ${m?"green":"red"}`,children:[!m&&"-",n.CurrencyFormat.replace("%s",P(Math.abs(e.amount)))]})})]}),a("div",{className:"date",children:D(e.timestamp,o.time.twelveHourClock)})]})]})})}),a("div",{className:"subtitle",children:a("div",{className:"title",children:s("APPS.WALLET.LATEST_BILLS")})}),r.bills&&r.bills.length>0&&a("section",{children:r.bills&&(r==null?void 0:r.bills.map((e,d)=>{let m=e.amount>0,p=e.company.match(/\d{10}/);return t("div",{className:"item multi",children:[e.logo?a("img",{src:e.logo}):!p&&a("div",{className:"image",children:e.company[0]}),t("div",{className:"info",children:[t("div",{className:"transaction-header",children:[a("div",{className:"title",children:p?S(e.company):e.company}),a("div",{className:"right",children:t("div",{className:`amount ${m?"green":"red"}`,children:[!m&&"-",n.CurrencyFormat.replace("%s",P(Math.abs(e.amount)))]})})]}),a("div",{className:"date",children:D(e.timestamp,o.time.twelveHourClock)})]})]})}))})]})]})]})}const G=({amount:o})=>{const n=g($),[r,L]=i.useState(!0),N=g(F.Settings);let u;return r&&(N!=null&&N.streamerMode)?u=P("*".repeat(C(o,2).toString().length)):u=P(C(o,2)),a("div",{className:"value",onClick:()=>L(!r),children:n.CurrencyFormat.replace("%s",u)})};export{j as default};
